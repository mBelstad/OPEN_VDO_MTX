version: '3.8'

services:
  mediamtx:
    image: bluenviron/mediamtx:latest
    container_name: mediamtx
    environment:
      - MTX_LOGLEVEL=debug
      - MTX_WEBRTC_ENCRYPTION=optional
      - MTX_WEBRTC_ALLOWORIGIN=https://prekestudio.itagenten.no
      - MTX_WEBRTC_ICESERVERS=["stun:stun.l.google.com:19302","stun:stun.cloudflare.com:3478"]
      - MTX_WEBRTC_ICEHOSTNAT1TO1IPS=["65.109.32.111"]
      - MTX_WEBRTC_ADDITIONALHEADERS={"Access-Control-Allow-Origin":"https://prekestudio.itagenten.no","Access-Control-Allow-Methods":"OPTIONS, POST","Access-Control-Allow-Headers":"content-type,authorization"}
    ports:
      - "8890:8889" # External port 8890 â†’ internal 8889 (avoid conflicts)
      - "8189:8189/udp" # ICE/UDP media. Required for WebRTC to flow.
    restart: unless-stopped


